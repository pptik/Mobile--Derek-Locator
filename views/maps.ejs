<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <link rel="icon" type="image/png" href="/assets/img/shortcut-icon.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>

    <title>Map | Mobil Derek Administrator</title>

    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport'/>
    <meta name="viewport" content="width=device-width"/>


    <!-- Bootstrap core CSS     -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet"/>

    <!-- Animation library for notifications   -->
    <link href="/assets/css/animate.min.css" rel="stylesheet"/>

    <!--  Light Bootstrap Table core CSS    -->
    <link href="/assets/css/light-bootstrap-dashboard.css" rel="stylesheet"/>


    <!--  CSS for Demo Purpose, don't include it in your project     -->
    <link href="/assets/css/demo.css" rel="stylesheet"/>


    <!--     Fonts and icons     -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,700,300' rel='stylesheet' type='text/css'>
    <link href="/assets/css/pe-icon-7-stroke.css" rel="stylesheet"/>

    <style>
        .gray-color{
            color: #6C7A89;
        }
        .small-font{
            font-size: small;
        }
        .azure{
            color:#3CBFD8;
        }
    </style>
</head>
<body>

<div class="wrapper">


    <div class="sidebar" data-color="azure" data-image="assets/img/sidebar-6.jpg">

        <!--   you can change the color of the sidebar using: data-color="blue | azure | green | orange | red | purple" -->


        <div class="sidebar-wrapper">
            <div class="logo">
                <a href="/" class="simple-text">
                    Mobil Derek Administrator
                </a>
            </div>

            <ul class="nav">
                <!--<li>
                    <a href="/dashboard">
                        <i class="pe-7s-graph"></i>
                        <p>Dashboard</p>
                    </a>
                </li>-->
                <li class="active">
                    <a href="/map" class="azure">
                        <i class="pe-7s-map-marker"></i>
                        <p>Map</p>
                    </a>
                </li>
            </ul>
        </div>
    </div>


    <div class="main-panel">
        <nav class="navbar navbar-default navbar-fixed">
            <div class="container-fluid">
                <div class="navbar-header">
                    <a class="navbar-brand" href="/map" style="color:#3CBFD8;">Map</a>
                </div>
                <div class="collapse navbar-collapse">


                    <ul class="nav navbar-nav navbar-right">
                        <!--<li>
                            <a href="">
                                Account
                            </a>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                Dropdown
                                <b class="caret"></b>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a href="#">Action</a></li>
                                <li><a href="#">Another action</a></li>
                                <li><a href="#">Something</a></li>
                                <li><a href="#">Another action</a></li>
                                <li><a href="#">Something</a></li>
                                <li class="divider"></li>
                                <li><a href="#">Separated link</a></li>
                            </ul>
                        </li>-->
                        <li>
                            <a href="/users/logout">
                                Log out
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <div id="map"></div>
        <br/>
        <div class="content">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="header">
                                <h4 class="title">Driver</h4>
                                <p class="category">Data pengemudi yang berada pada peta</p>
                            </div>
                            <div class="content">
                                <div id="driver-data"></div>

                                <!--<div class="footer">
                                    <div class="stats">
                                        <i class="fa fa-history"></i> Updated 3 minutes ago
                                    </div>
                                </div>-->
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card">
                            <div class="header">
                                <h4 class="title">Report</h4>
                                <p class="category">Panic Button yang dikirimkan oleh pengguna</p>
                            </div>
                            <div class="content">
                                <div id="report-data"></div>
                                <!--<div class="footer">
                                    <div class="stats">
                                        <i class="fa fa-history"></i> Updated 3 minutes ago
                                    </div>
                                </div>-->
                            </div>
                        </div>
                    </div>
                </div>




            </div>
        </div>



    </div>


</div>


</body>

<!--   Core JS Files   -->
<script src="/assets/js/jquery-1.10.2.js" type="text/javascript"></script>
<script src="/assets/js/bootstrap.min.js" type="text/javascript"></script>

<!--  Checkbox, Radio & Switch Plugins -->
<script src="/assets/js/bootstrap-checkbox-radio-switch.js"></script>

<!--  Charts Plugin -->
<script src="/assets/js/chartist.min.js"></script>

<!--  Notifications Plugin    -->
<script src="/assets/js/bootstrap-notify.js"></script>


<!--  Smooth Scroll    -->
<script src="/assets/js/smooth-scroll.js"></script>

<!--  Google Maps Plugin    -->
<script src="https://maps.googleapis.com/maps/api/js?v=3&amp;sensor=false&amp;key=AIzaSyBu5nZKbeK-WHQ70oqOWo-_4VmwOwKP9YQ"></script>
<!--<script src="/javascripts/custom.js"></script>-->
<script>
    /*function detailDriver(i) {
        google.maps.event.trigger(markers[i], 'click');
        //alert(i);
    }*/
    smoothScroll.init({
        speed: 100
    });

    $().ready(function () {

        //Insisial penampung drivers
        var data = [];
        data = '<%- JSON.stringify(dataDrivers) %>';
        data = JSON.parse(data);

        //Insisial penampung reports
        var dataReports = [];
        dataReports = '<%- JSON.stringify(dataReports) %>';
        dataReports= JSON.parse(dataReports);

        console.log("Data driver awal: "+data);
        console.log("Data report awal: "+dataReports);
        /*map.initMap(data);
        map.startMap();*/

        //Pengaturan map
        var locations = data;
        var locationsReports = dataReports;

        var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 20,
            center: new google.maps.LatLng(-6.881694, 107.615820),
            mapTypeId: google.maps.MapTypeId.ROADMAP
        });

        //pengaturan awal marker driver
        var infowindow = new google.maps.InfoWindow();

        //var marker, i;
        var i;
        var marker = [];

        var markerImage = 'images/driver-marker.png';

        for (i = 0; i < locations.length; i++) {

            var displayDriver = String(data[i]).split(',');

            $("#driver-data").append("<a id='driver-ke-"+i+"' data-scroll href='#map' style='color:#83C377;'>" + displayDriver[6] + "</a>" +
                    "<br/><hr/>");

            /*$('#driver-ke-'+i+'').click(function () {
                alert(i);
            });*/

            $('#driver-ke-'+i+'').click(function(event) {

                var get_id = event.target.id.split('-');
                //alert(get_id[2])
                google.maps.event.trigger(marker[get_id[2]], 'click');
            });


            marker[i] = new google.maps.Marker({
                position: new google.maps.LatLng(locations[i][1], locations[i][2]),
                map: map,
                icon: markerImage,
                iterasi:i
            });

            (function(marker,i){
                google.maps.event.addListener(marker, 'click', function(){
                    //alert(toado[i][2]);
                    var contentString = '<div class="info-window">' +
                            '<h3 class="gray-color" style="color:#83C377;"><b> Nomor Unit : '+locations[i][5]+'</b></h3>' +
                            '<div class="info-content gray-color small-font">' +
                            '<p><b style="color:#83C377;">Nama driver :</b> '+locations[i][4]+'<br />' +
                            '<b style="color:#83C377;">Nomor Telepon :</b> '+locations[i][6]+'<br />' +
                            '<b style="color:#83C377;">Lokasi Sekarang :</b> '+locations[i][0]+'<br />' +
                            '<b style="color:#83C377;">Terakhir update lokasi : </b>'+locations[i][7]+'<br />' +
                            '</p>' +
                            '</div>' +
                            '</div>';
                    infowindow.setContent(contentString);
                    infowindow.open(map,marker);
                });
            }(marker[i],i));

        }

        //--- fit bounding
        var latlng = [];
        for (var x = 0; x < locations.length; x++){
            latlng[x] = new google.maps.LatLng(locations[x][1], locations[x][2]);
        }

        var latlngbounds = new google.maps.LatLngBounds();
        for (var i = 0; i < latlng.length; i++) {
            latlngbounds.extend(latlng[i]);
        }
        map.fitBounds(latlngbounds);

        var contentString = '<div class="info-window">' +
                '<h3>shit</h3>' +
                '<div class="info-content">' +
                '<p>Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Vestibulum tortor quam, feugiat vitae, ultricies eget, tempor sit amet, ante. Donec eu libero sit amet quam egestas semper. Aenean ultricies mi vitae est. Mauris placerat eleifend leo.</p>' +
                '</div>' +
                '</div>';

        var infowindow = new google.maps.InfoWindow({
            content: contentString,
            maxWidth: 400
        });





        var styles = [{"featureType": "landscape", "stylers": [{"saturation": -100}, {"lightness": 65}, {"visibility": "on"}]}, {"featureType": "poi", "stylers": [{"saturation": -100}, {"lightness": 51}, {"visibility": "simplified"}]}, {"featureType": "road.highway", "stylers": [{"saturation": -100}, {"visibility": "simplified"}]}, {"featureType": "road.arterial", "stylers": [{"saturation": -100}, {"lightness": 30}, {"visibility": "on"}]}, {"featureType": "road.local", "stylers": [{"saturation": -100}, {"lightness": 40}, {"visibility": "on"}]}, {"featureType": "transit", "stylers": [{"saturation": -100}, {"visibility": "simplified"}]}, {"featureType": "administrative.province", "stylers": [{"visibility": "off"}]}, {"featureType": "water", "elementType": "labels", "stylers": [{"visibility": "on"}, {"lightness": -25}, {"saturation": -100}]}, {"featureType": "water", "elementType": "geometry", "stylers": [{"hue": "#ffff00"}, {"lightness": -25}, {"saturation": -97}]}];

        map.set('styles', styles);
        //pengaturan akhir marker driver

        //pengaturan awal marker report
        var infowindowReports = new google.maps.InfoWindow();//awalnya infowindow

        //var marker, i;
        var i;
        var markerReports = [];//awalnya marker

        var markerImageReports = 'images/report-marker.png';//awalnya markerImage

        for (i = 0; i < locationsReports.length; i++) {//awalnya locations

            var displayReports = String(dataReports[i]).split(',');//awalnya data Driver
            console.log("Data display report "+displayReports);
            $("#report-data").append("<a id='report-ke-"+i+"' data-scroll href='#map' style='color:#e12f4a;'>" + displayReports[5] + "</a>" +
                    "<br/><hr/>");

            /*$('#driver-ke-'+i+'').click(function () {
             alert(i);
             });*/

            $('#report-ke-'+i+'').click(function(event) {

                var get_id = event.target.id.split('-');
                //alert(get_id[2])
                google.maps.event.trigger(markerReports[get_id[2]], 'click');
            });


            markerReports[i] = new google.maps.Marker({
                position: new google.maps.LatLng(locationsReports[i][1], locationsReports[i][2]),
                map: map,
                icon: markerImageReports,
                iterasi:i
            });

            (function(marker,i){
                google.maps.event.addListener(marker, 'click', function(){
                    //alert(toado[i][2]);
                    var contentString = '<div class="info-window">' +
                            '<h3 class="gray-color" style="color:#e12f4a;"><b> Nomor Unit : '+locationsReports[i][4]+'</b></h3>' +
                            '<div class="info-content gray-color small-font">' +
                            '<p><b style="color:#e12f4a;">Nama driver :</b> '+locationsReports[i][4]+'<br />' +
                            '<b style="color:#e12f4a;">Nomor Telepon :</b> '+locationsReports[i][6]+'<br />' +
                            '<b style="color:#e12f4a;">Lokasi Sekarang :</b> '+locationsReports[i][0]+'<br />' +
                            '<b style="color:#e12f4a;">Terakhir update lokasi : </b>'+locationsReports[i][7]+'<br />' +
                            '</p>' +
                            '</div>' +
                            '</div>';
                    infowindowReports.setContent(contentString);
                    infowindowReports.open(map,marker);
                });
            }(markerReports[i],i));

        }

        //--- fit bounding
        var latlng = [];
        for (var x = 0; x < locationsReports.length; x++){
            latlng[x] = new google.maps.LatLng(locations[x][1], locations[x][2]);
        }

        var latlngbounds = new google.maps.LatLngBounds();
        for (var i = 0; i < latlng.length; i++) {
            latlngbounds.extend(latlng[i]);
        }
        map.fitBounds(latlngbounds);

        var contentString = '<div class="info-window">' +
                '<h3>shit</h3>' +
                '<div class="info-content">' +
                '<p>Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Vestibulum tortor quam, feugiat vitae, ultricies eget, tempor sit amet, ante. Donec eu libero sit amet quam egestas semper. Aenean ultricies mi vitae est. Mauris placerat eleifend leo.</p>' +
                '</div>' +
                '</div>';

        var infowindow = new google.maps.InfoWindow({
            content: contentString,
            maxWidth: 400
        });





        var styles = [{"featureType": "landscape", "stylers": [{"saturation": -100}, {"lightness": 65}, {"visibility": "on"}]}, {"featureType": "poi", "stylers": [{"saturation": -100}, {"lightness": 51}, {"visibility": "simplified"}]}, {"featureType": "road.highway", "stylers": [{"saturation": -100}, {"visibility": "simplified"}]}, {"featureType": "road.arterial", "stylers": [{"saturation": -100}, {"lightness": 30}, {"visibility": "on"}]}, {"featureType": "road.local", "stylers": [{"saturation": -100}, {"lightness": 40}, {"visibility": "on"}]}, {"featureType": "transit", "stylers": [{"saturation": -100}, {"visibility": "simplified"}]}, {"featureType": "administrative.province", "stylers": [{"visibility": "off"}]}, {"featureType": "water", "elementType": "labels", "stylers": [{"visibility": "on"}, {"lightness": -25}, {"saturation": -100}]}, {"featureType": "water", "elementType": "geometry", "stylers": [{"hue": "#ffff00"}, {"lightness": -25}, {"saturation": -97}]}];

        map.set('styles', styles);
        //pengaturan akhir marker report

        //Akhir pengaturan map





    });
</script>

<!-- Light Bootstrap Table Core javascript and methods for Demo purpose -->
<script src="/assets/js/light-bootstrap-dashboard.js"></script>

<!-- Light Bootstrap Table DEMO methods, don't include it in your project! -->
<script src="/assets/js/demo.js"></script>


</html>
